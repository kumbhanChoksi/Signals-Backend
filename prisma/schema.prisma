generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-arm64-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Tenant {
  id        String   @id @default(uuid())
  name      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  users     User[]
}

model User {
  id           String   @id @default(uuid())
  firstName    String
  lastName     String
  email        String   @unique
  passwordHash String
  tenantId     String
  tenant       Tenant   @relation(fields: [tenantId], references: [id])
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model Candle {
  id        String   @id @default(uuid())
  tenantId  String
  symbol    String
  timeframe String
  timestamp DateTime
  open      Float
  high      Float
  low       Float
  close     Float
  volume    Float
  createdAt DateTime @default(now())

  @@unique([tenantId, symbol, timeframe, timestamp])
}

model IdempotencyKey {
  key       String   @id
  tenantId  String
  createdAt DateTime @default(now())

  @@unique([key, tenantId])
}

enum JobType {
  SIGNAL_GENERATION
}

enum JobStatus {
  PENDING
  RUNNING
  SUCCESS
  FAILED
}

enum SignalOutput {
  BUY
  SELL
  HOLD
}

model Job {
  id        String    @id @default(uuid())
  tenantId  String
  type      JobType
  status    JobStatus
  payload   Json
  error     String?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  signal    Signal?
}

model Signal {
  id         String       @id @default(uuid())
  jobId      String       @unique
  tenantId   String
  output     SignalOutput
  confidence Float
  summary    String
  features   Json
  vetoes     Json
  createdAt  DateTime     @default(now())

  job Job @relation(fields: [jobId], references: [id])
}
